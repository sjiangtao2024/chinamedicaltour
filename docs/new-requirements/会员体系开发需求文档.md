# **会员体系开发需求文档 (Technical Specification)**

## **1\. 项目背景与目标**

基于“透明化账单系统”逻辑，构建一套支持多等级（Guest, Silver, Gold, Diamond）的会员管理与计费引擎。核心目标是实现费率自动计算、权益自动生效及透明化账单展示。

## **2\. 数据模型设计 (Data Models)**

### **2.1 会员等级配置 (Membership Config)**

| 字段名 | 类型 | 说明 | 示例值 |
| :---- | :---- | :---- | :---- |
| tier\_id | String | 等级ID | diamond\_001 |
| name | String | 等级名称 | Diamond |
| annual\_fee | Decimal | 年费 | 1499.00 |
| service\_fee\_rate | Float | 综合服务费率 | 0.08 (即 8%) |
| hard\_cost\_discount | Float | 硬成本折扣 | 0.85 (即 85折) |
| free\_consult\_count | Int | 免费预诊次数 | 3 |
| consult\_doctor\_level | String | 免费预诊医生级别 | Chief Physician |
| app\_permission | Array | 权限列表 | \['24\_7\_emergency', 'priority\_support'\] |

### **2.2 用户模型扩展 (User Extension)**

| 字段名 | 类型 | 说明 | 示例值 |
| :---- | :---- | :---- | :---- |
| membership\_tier | String | 当前会员等级 | Gold |
| membership\_expires | DateTime | 会员到期时间 | 2025-12-31 |
| remaining\_consults | Int | 剩余免费咨询次数 | 2 |

## **3\. 核心业务逻辑 (Core Business Logic)**

### **3.1 费率计算引擎 (Pricing Engine)**

这是系统的核心，需根据用户等级动态计算订单总额。

**逻辑公式：**

1. **打折硬成本** \= $\\sum(\\text{Hard Cost Items}) \\times \\text{User Tier Hard Cost Discount}$  
2. **服务费** \= $(\\text{打折硬成本} \+ \\text{Soft Cost Items}) \\times \\text{User Tier Service Fee Rate}$  
3. **最终总价** \= $\\text{打折硬成本} \+ \\text{Soft Cost Items} \+ \\text{服务费}$

### **3.2 会员权益触发**

* **咨询抵扣逻辑**：在下单“医生预诊”服务时，系统需判断 remaining\_consults \> 0 且 医生等级匹配，则自动将该项费用置为 $0，并扣减次数。  
* **行程定制费逻辑**：若等级为 Gold 或 Diamond，系统自动豁免 $300 的行程策划费。

## **4\. 接口需求 (API Endpoints)**

### **4.1 计费试算接口**

* **Endpoint**: POST /api/v1/orders/calculate-preview  
* **输入**: 用户ID, 预选项目列表（Item IDs, 原价）。  
* **输出**:  
  * 各分类明细（硬成本原价 vs 折后价）。  
  * 计算出的服务费。  
  * 相对于 Guest 身份节省的总金额（用于前端展示“Savings”）。

### **4.2 会员状态管理**

* GET /api/v1/user/membership: 获取当前等级、剩余权益、到期提醒。  
* POST /api/v1/membership/upgrade: 处理支付回调后的等级变更逻辑。

## **5\. 前端功能实现建议 (Frontend Implementation)**

### **5.1 实战省钱计算器 (Savings Calculator)**

* **功能描述**：允许用户输入预计的医疗/旅行预算，实时滑动查看不同会员等级下的总支出对比。  
* **技术点**：前端本地逻辑实现计算公式，无需频繁请求后端，提升交互流畅度。

### **5.2 透明账单展示**

* **UI组件**：订单详情页需采用“分层折叠”设计。  
  * 第一层：🟢 硬成本（附带收据原件预览位）。  
  * 第二层：🔵 软成本（专家人力）。  
  * 第三层：🔴 服务费（明确标出费率）。

### **5.3 会员特权标识**

* 在预约挂号、接送机等服务界面，根据用户等级展示“Green Channel”标识（如：优先、特需、24/7专线）。

## **6\. 安全与风控**

* **次数校验**：免费咨询次数的扣减必须在后端事务中完成，防止并发刷单。  
* **收据加密**：硬成本对应的收据原件文件需设置访问权限，仅订单关联用户可见。